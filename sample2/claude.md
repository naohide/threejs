# Hand Grab Physics - 仕様書

## 概要

Three.jsとMediaPipeを使用した、手で3Dオブジェクトを掴んで操作できるインタラクティブデモ。

## 技術スタック

- **Three.js** (r128): 3Dレンダリング
- **MediaPipe Hands**: ハンドトラッキング
- **Vanilla JavaScript**: ロジック実装

## 機能

### 1. 物理シミュレーション

| パラメータ | 値 | 説明 |
|-----------|-----|------|
| gravity | -0.3 | 重力加速度 |
| groundY | -250 | 地面のY座標 |
| objectBounce | 0.5 | 跳ね返り係数 |
| objectFriction | 0.98 | 地面での摩擦 |
| airResistance | 0.995 | 空気抵抗 |
| maxVelocity | 30 | 最大速度 |

**オブジェクトの挙動:**
- 重力により下方向に加速
- 地面に衝突すると跳ね返る
- 摩擦と空気抵抗で徐々に減速
- 壁（X/Z方向）に衝突すると跳ね返る
- 角速度による回転アニメーション

### 2. オブジェクトの種類

初期状態で8個のランダムなオブジェクトを生成。

| 形状 | Three.js Geometry |
|------|-------------------|
| 箱 | BoxGeometry |
| 球 | SphereGeometry |
| 円柱 | CylinderGeometry |
| コーン | ConeGeometry |
| トーラス | TorusGeometry |

- サイズ: 30〜70（ランダム）
- 色: HSLでランダム生成
- マテリアル: MeshStandardMaterial（メタリック、光沢あり）

### 3. ハンドトラッキング

**検出設定:**
- 最大2本の手を検出
- 検出信頼度: 0.7
- トラッキング信頼度: 0.5

**ピンチジェスチャー検出:**
- 親指先端（ランドマーク4）と人差し指先端（ランドマーク8）の距離を計算
- 距離 < 0.08（正規化座標）でピンチと判定

### 4. 掴み操作

| パラメータ | 値 | 説明 |
|-----------|-----|------|
| grabRadius | 80 | 掴める距離（ピクセル） |
| pinchThreshold | 0.08 | ピンチ判定閾値 |
| throwMultiplier | 2.0 | 投げ速度倍率 |

**掴みフロー:**
1. 手がオブジェクトの近く（80px以内）にある
2. ピンチジェスチャーを検出
3. 最も近いオブジェクトを掴む
4. オブジェクトは手の位置に追従（lerp補間）
5. ピンチを解除すると落下
6. 手の移動速度に応じて投げる

### 5. 視覚的フィードバック

**手のインジケーター:**
- 左手: 緑色の半透明球体
- 右手: オレンジ色の半透明球体

**オブジェクト:**
- 通常時: emissiveIntensity = 0.1
- 掴まれている時: emissiveIntensity = 0.5（光る）

**ステータス表示:**
- Not Detected: 赤（手が検出されていない）
- Open: 緑（手を開いている）
- Pinching: 緑（ピンチ中）
- Grabbing: 黄（オブジェクトを掴んでいる）

### 6. シーン構成

**カメラ:**
- PerspectiveCamera
- FOV: 75度
- 位置: z = 500

**ライティング:**
- AmbientLight（環境光）
- DirectionalLight（影付き）
- PointLight x2（シアン、マゼンタ）

**地面:**
- PlaneGeometry（1500 x 1500）
- GridHelper（30分割、シアン色）

## 操作方法

1. ブラウザでindex.htmlを開く
2. カメラへのアクセスを許可
3. 手を画面に向ける
4. オブジェクトの近くで親指と人差し指をつまむ → 掴む
5. 手を動かす → オブジェクトが追従
6. 指を離す → オブジェクトが落下/投げる
7. 「Add Random Object」ボタンでオブジェクト追加

## UI構成

```
┌─────────────────────────────────────────────┐
│ [FPS]                    [Objects] [Camera] │
│                                             │
│                                             │
│              3D Scene                       │
│                                             │
│                                             │
│              [Instructions]                 │
│ [Left Hand]              [Right Hand]       │
│              [Add Button]                   │
└─────────────────────────────────────────────┘
```

## 座標系変換

MediaPipeの正規化座標からThree.jsワールド座標への変換:

```javascript
// MediaPipe: (0,0)=左上, (1,1)=右下
// Three.js: (0,0,0)=中心

x = (0.5 - handPos.x) * window.innerWidth   // 左右反転
y = (0.5 - handPos.y) * window.innerHeight  // 上下反転
z = -handPos.z * 500                        // 奥行きスケール
```

## 今後の拡張案

- [ ] オブジェクト同士の衝突判定
- [ ] 両手で1つのオブジェクトを掴む
- [ ] オブジェクトの削除機能
- [ ] サウンドエフェクト
- [ ] オブジェクトのサイズ変更（両手ジェスチャー）
- [ ] 特定ジェスチャーで特殊効果
